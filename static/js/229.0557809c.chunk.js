"use strict";(self.webpackChunk_3d_examples=self.webpackChunk_3d_examples||[]).push([[229],{6229:function(e,t,n){n.r(t),n.d(t,{default:function(){return f}});var i=n(5671),r=n(3144),a=n(136),s=n(9388),o=n(7313),c=n(3562),u=n(6892),d=n(4849),l=n(40),h=n(6417),f=function(e){(0,a.Z)(o,e);var t=(0,s.Z)(o);function o(){var e;return(0,i.Z)(this,o),(e=t.call(this)).initThree=function(){var t,i=document.getElementsByClassName("section")[0],r=i.clientWidth,a=i.clientHeight,s=new c.xsS,o=new c.CP7({canvas:document.querySelector("#canvas-container"),antialias:!0,alpha:!0,powerPreference:"high-performance"});o.autoClear=!0,o.setPixelRatio(Math.min(window.devicePixelRatio,2)),o.setSize(r,a),o.outputEncoding=c.knz;var h=new c.CP7({canvas:document.querySelector("#canvas-container-details"),antialias:!1});h.setPixelRatio(Math.min(window.devicePixelRatio,2)),h.setSize(r,a),h.outputEncoding=c.knz;var f=new c.ZAu;s.add(f);var v=new c.cPb(35,r/a,1,100);v.position.set(19,1.54,-.1),f.add(v);var p=new c.cPb(35,i.clientWidth/i.clientHeight,1,100);p.position.set(3.2,2.8,3.2),p.rotation.set(0,1,0),s.add(p),window.addEventListener("resize",(function(){var e=document.getElementsByClassName("section")[0];v.aspect=e.clientWidth/e.clientHeight,v.updateProjectionMatrix(),p.aspect=e.clientWidth/e.clientHeight,p.updateProjectionMatrix(),o.setSize(e.clientWidth,e.clientHeight),h.setSize(e.clientWidth,e.clientHeight),o.setPixelRatio(Math.min(window.devicePixelRatio,2)),h.setPixelRatio(Math.min(window.devicePixelRatio,2))}));var m=new c.Ox3(16777215,.8);m.position.set(-100,0,-100),s.add(m);var y=new c.cek(8978414,2.7,4,3);y.position.set(30,3,1.8),s.add(y);var _=document.querySelector(".lds-roller"),w=document.getElementById("loading-text-intro"),g=new c.lLk;g.onLoad=function(){document.querySelector(".content").style.visibility="visible";var e={y:0};new u.w.Tween(e).to({y:100},900).easing(u.w.Easing.Quadratic.InOut).start().onUpdate((function(){w.style.setProperty("transform","translate( 0, ".concat(e.y,"%)"))})).onComplete((function(){w.parentNode.removeChild(document.getElementById("loading-text-intro")),u.w.remove(this)})),new u.w.Tween(v.position.set(0,4,2)).to({x:0,y:2.4,z:5.8},3500).easing(u.w.Easing.Quadratic.InOut).start().onComplete((function(){u.w.remove(this),document.querySelector(".header").classList.add("ended"),document.querySelector(".description").classList.add("ended")})),_.parentNode.removeChild(_),window.scroll(0,0)};var b=new d._;b.setDecoderPath("libs/draco/"),b.setDecoderConfig({type:"js"});var k=new l.E(g);function x(e,t){new u.w.Tween(p.position).to(e,1800).easing(u.w.Easing.Quadratic.InOut).start().onComplete((function(){u.w.remove(this)})),new u.w.Tween(p.rotation).to(t,1800).easing(u.w.Easing.Quadratic.InOut).start().onComplete((function(){u.w.remove(this)}))}k.setDRACOLoader(b),k.load(n(1023),(function(e){e.scene.traverse((function(e){e.isMesh&&(t=e.material,e.material=new c.xoR({shininess:100}))})),s.add(e.scene),t.dispose(),o.renderLists.dispose()})),document.getElementById("one").addEventListener("click",(function(){document.getElementById("one").classList.add("active"),document.getElementById("three").classList.remove("active"),document.getElementById("two").classList.remove("active"),document.getElementById("content").innerHTML="\u6628\u591c\u897f\u98ce\u51cb\u78a7\u6811\u3002\u72ec\u4e0a\u9ad8\u697c\uff0c\u671b\u5c3d\u5929\u6daf\u8def\u3002",x({x:3.2,y:2.8,z:3.2},{y:1})})),document.getElementById("two").addEventListener("click",(function(){document.getElementById("two").classList.add("active"),document.getElementById("one").classList.remove("active"),document.getElementById("three").classList.remove("active"),document.getElementById("content").innerHTML="\u8863\u5e26\u6e10\u5bbd\u7ec8\u4e0d\u6094\uff0c\u4e3a\u4f0a\u6d88\u5f97\u4eba\u6194\u60b4\u3002",x({x:-1.4,y:2.8,z:4.4},{y:-.1})})),document.getElementById("three").addEventListener("click",(function(){document.getElementById("three").classList.add("active"),document.getElementById("one").classList.remove("active"),document.getElementById("two").classList.remove("active"),document.getElementById("content").innerHTML="\u4f17\u91cc\u5bfb\u4ed6\u5343\u767e\u5ea6\uff0c\u84e6\u7136\u56de\u9996\uff0c\u90a3\u4eba\u5374\u5728\u706f\u706b\u9611\u73ca\u5904\u3002",x({x:-4.8,y:2.9,z:3.2},{y:-.75})}));var I={x:0,y:0},E=new c.SUY,T=0;!function t(){u.w.update(),e.secondContainer?h.render(s,p):o.render(s,v);var n=E.getElapsedTime(),i=n-T;T=n;var r=I.y;y.position.y-=(9*r+y.position.y-2)*i;var a=I.x;y.position.x+=2*(8*a-y.position.x)*i,f.position.z-=2*(r/3+f.position.z)*i,f.position.x+=2*(a/3-f.position.x)*i,requestAnimationFrame(t)}(),document.addEventListener("mousemove",(function(e){e.preventDefault(),I.x=e.clientX/window.innerWidth-.5,I.y=e.clientY/window.innerHeight-.5,j(e)}),!1);var C=document.querySelector(".cursor"),j=function(e){var t=e.clientX,n=e.clientY;C.style.cssText="left: ".concat(t,"px; top: ").concat(n,"px;")}},e.handleMenu=function(){var t=new IntersectionObserver((function(t){t[0].intersectionRatio>.05?e.secondContainer=!0:e.secondContainer=!1}),{threshold:.05}),n=document.querySelector(".second");t.observe(n);var i=document.querySelectorAll("nav > .a");function r(e){var t=this.querySelector("span");if("mouseleave"===e.type)t.style.cssText="";else{var n=e.offsetX,i=e.offsetY,r=n/this.offsetWidth*40-20,a=i/this.offsetHeight*40-20;t.style.cssText="transform: translate(".concat(r,"px, ").concat(a,"px);")}}i.forEach((function(e){return e.addEventListener("mousemove",r)})),i.forEach((function(e){return e.addEventListener("mouseleave",r)}))},e.secondContainer=!1,e}return(0,r.Z)(o,[{key:"componentDidMount",value:function(){this.initThree(),this.handleMenu()}},{key:"componentWillUnmount",value:function(){this.setState=function(){}}},{key:"render",value:function(){return(0,h.jsxs)("div",{className:"shadow_page",children:[(0,h.jsxs)("div",{className:"lds-roller",children:[(0,h.jsx)("div",{}),(0,h.jsx)("div",{}),(0,h.jsx)("div",{}),(0,h.jsx)("div",{}),(0,h.jsx)("div",{}),(0,h.jsx)("div",{}),(0,h.jsx)("div",{}),(0,h.jsx)("div",{})]}),(0,h.jsx)("div",{id:"loading-text-intro",children:(0,h.jsx)("p",{children:"Loading"})}),(0,h.jsxs)("div",{className:"content",style:{visibility:"hidden"},children:[(0,h.jsxs)("nav",{className:"header",children:[(0,h.jsx)("a",{href:"https://github.com/dragonir/threejs-odessey",className:"active a",children:(0,h.jsx)("span",{children:"\u9996\u9875"})}),(0,h.jsx)("a",{href:"https://github.com/dragonir/threejs-odessey",className:"a",children:(0,h.jsx)("span",{children:"\u5173\u4e8e"})}),(0,h.jsx)("a",{href:"https://github.com/dragonir/threejs-odessey",className:"a",children:(0,h.jsx)("span",{children:"\u4f5c\u54c1"})}),(0,h.jsx)("a",{href:"https://github.com/dragonir/threejs-odessey",className:"a",children:(0,h.jsx)("span",{children:"\u6211\u7684"})}),(0,h.jsx)("a",{href:"https://github.com/dragonir/threejs-odessey",className:"a",children:(0,h.jsx)("span",{children:"\u66f4\u591a"})}),(0,h.jsx)("div",{className:"cursor"})]}),(0,h.jsxs)("section",{className:"section first",children:[(0,h.jsxs)("div",{className:"info",children:[(0,h.jsx)("h2",{className:"name",children:"DRAGONIR"}),(0,h.jsx)("h1",{className:"title",children:"THREE.JS ODESSEY"}),(0,h.jsx)("p",{className:"description",children:"\xa0"})]}),(0,h.jsx)("canvas",{id:"canvas-container",className:"webgl"})]}),(0,h.jsxs)("section",{className:"section second",children:[(0,h.jsxs)("div",{className:"second-container",children:[(0,h.jsxs)("ul",{children:[(0,h.jsx)("li",{id:"one",className:"active",children:"\u5165\u95e8"}),(0,h.jsx)("li",{id:"two",children:"\u57fa\u7840"}),(0,h.jsx)("li",{id:"three",children:"\u8fdb\u9636"})]}),(0,h.jsx)("p",{className:"text",id:"content",children:"\u6628\u591c\u897f\u98ce\u51cb\u78a7\u6811\u3002\u72ec\u4e0a\u9ad8\u697c\uff0c\u671b\u5c3d\u5929\u6daf\u8def\u3002"})]}),(0,h.jsx)("canvas",{id:"canvas-container-details",className:"webgl"})]})]}),(0,h.jsx)("a",{className:"github",href:"https://github.com/dragonir/threejs-odessey",target:"_blank",rel:"noreferrer",title:"dragonir",children:(0,h.jsx)("svg",{height:"36","aria-hidden":"true",viewBox:"0 0 16 16",version:"1.1",width:"36","data-view-component":"true",children:(0,h.jsx)("path",{fill:"#FFFFFF",fillRule:"evenodd",d:"M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"})})})]})}}]),o}(o.Component)},1023:function(e,t,n){e.exports=n.p+"static/media/kas.4e32557cec37d768dce5.glb"},6892:function(e,t,n){n.d(t,{w:function(){return a}});var i=function(){this._tweens={},this._tweensAddedDuringUpdate={}};i.prototype={getAll:function(){return Object.keys(this._tweens).map(function(e){return this._tweens[e]}.bind(this))},removeAll:function(){this._tweens={}},add:function(e){this._tweens[e.getId()]=e,this._tweensAddedDuringUpdate[e.getId()]=e},remove:function(e){delete this._tweens[e.getId()],delete this._tweensAddedDuringUpdate[e.getId()]},update:function(e,t){var n=Object.keys(this._tweens);if(0===n.length)return!1;for(e=void 0!==e?e:a.now();0<n.length;){this._tweensAddedDuringUpdate={};for(var i=0;i<n.length;i++){var r=this._tweens[n[i]];r&&!1===r.update(e)&&(r._isPlaying=!1,t||delete this._tweens[n[i]])}n=Object.keys(this._tweensAddedDuringUpdate)}return!0}};var r,a=new i;a.Group=i,a._nextId=0,a.nextId=function(){return a._nextId++},"undefined"==typeof self&&"undefined"!=typeof process&&process.hrtime?a.now=function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}:"undefined"!=typeof self&&void 0!==self.performance&&void 0!==self.performance.now?a.now=self.performance.now.bind(self.performance):void 0!==Date.now?a.now=Date.now:a.now=function(){return(new Date).getTime()},a.Tween=function(e,t){this._object=e,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._repeat=0,this._repeatDelayTime=void 0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=null,this._easingFunction=a.Easing.Linear.None,this._interpolationFunction=a.Interpolation.Linear,this._chainedTweens=[],this._onStartCallback=null,this._onStartCallbackFired=!1,this._onUpdateCallback=null,this._onCompleteCallback=null,this._onStopCallback=null,this._group=t||a,this._id=a.nextId()},a.Tween.prototype={getId:function(){return this._id},isPlaying:function(){return this._isPlaying},to:function(e,t){return this._valuesEnd=Object.create(e),void 0!==t&&(this._duration=t),this},duration:function(e){return this._duration=e,this},start:function(e){for(var t in this._group.add(this),this._isPlaying=!0,this._onStartCallbackFired=!1,this._startTime=void 0!==e?"string"==typeof e?a.now()+parseFloat(e):e:a.now(),this._startTime+=this._delayTime,this._valuesEnd){if(this._valuesEnd[t]instanceof Array){if(0===this._valuesEnd[t].length)continue;this._valuesEnd[t]=[this._object[t]].concat(this._valuesEnd[t])}void 0!==this._object[t]&&(this._valuesStart[t]=this._object[t],this._valuesStart[t]instanceof Array==0&&(this._valuesStart[t]*=1),this._valuesStartRepeat[t]=this._valuesStart[t]||0)}return this},stop:function(){return this._isPlaying&&(this._group.remove(this),this._isPlaying=!1,null!==this._onStopCallback&&this._onStopCallback(this._object),this.stopChainedTweens()),this},end:function(){return this.update(1/0),this},stopChainedTweens:function(){for(var e=0,t=this._chainedTweens.length;e<t;e++)this._chainedTweens[e].stop()},group:function(e){return this._group=e,this},delay:function(e){return this._delayTime=e,this},repeat:function(e){return this._repeat=e,this},repeatDelay:function(e){return this._repeatDelayTime=e,this},yoyo:function(e){return this._yoyo=e,this},easing:function(e){return this._easingFunction=e,this},interpolation:function(e){return this._interpolationFunction=e,this},chain:function(){return this._chainedTweens=arguments,this},onStart:function(e){return this._onStartCallback=e,this},onUpdate:function(e){return this._onUpdateCallback=e,this},onComplete:function(e){return this._onCompleteCallback=e,this},onStop:function(e){return this._onStopCallback=e,this},update:function(e){var t,n,i;if(e<this._startTime)return!0;for(t in!1===this._onStartCallbackFired&&(null!==this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),n=(e-this._startTime)/this._duration,n=0===this._duration||1<n?1:n,i=this._easingFunction(n),this._valuesEnd)if(void 0!==this._valuesStart[t]){var r=this._valuesStart[t]||0,a=this._valuesEnd[t];a instanceof Array?this._object[t]=this._interpolationFunction(a,i):("string"==typeof a&&(a="+"===a.charAt(0)||"-"===a.charAt(0)?r+parseFloat(a):parseFloat(a)),"number"==typeof a&&(this._object[t]=r+(a-r)*i))}if(null!==this._onUpdateCallback&&this._onUpdateCallback(this._object),1!==n)return!0;if(0<this._repeat){for(t in isFinite(this._repeat)&&this._repeat--,this._valuesStartRepeat){if("string"==typeof this._valuesEnd[t]&&(this._valuesStartRepeat[t]=this._valuesStartRepeat[t]+parseFloat(this._valuesEnd[t])),this._yoyo){var s=this._valuesStartRepeat[t];this._valuesStartRepeat[t]=this._valuesEnd[t],this._valuesEnd[t]=s}this._valuesStart[t]=this._valuesStartRepeat[t]}return this._yoyo&&(this._reversed=!this._reversed),void 0!==this._repeatDelayTime?this._startTime=e+this._repeatDelayTime:this._startTime=e+this._delayTime,!0}null!==this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var o=0,c=this._chainedTweens.length;o<c;o++)this._chainedTweens[o].start(this._startTime+this._duration);return!1}},a.Easing={Linear:{None:function(e){return e}},Quadratic:{In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)}},Cubic:{In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}},Quartic:{In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)}},Quintic:{In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}},Sinusoidal:{In:function(e){return 1-Math.cos(e*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return.5*(1-Math.cos(Math.PI*e))}},Exponential:{In:function(e){return 0===e?0:Math.pow(1024,e-1)},Out:function(e){return 1===e?1:1-Math.pow(2,-10*e)},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(2-Math.pow(2,-10*(e-1)))}},Circular:{In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}},Elastic:{In:function(e){return 0===e?0:1===e?1:-Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)},Out:function(e){return 0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin(5*(e-.1)*Math.PI)+1},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?-.5*Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI):.5*Math.pow(2,-10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)+1}},Back:{In:function(e){return e*e*(2.70158*e-1.70158)},Out:function(e){return--e*e*(2.70158*e+1.70158)+1},InOut:function(e){var t=2.5949095;return(e*=2)<1?e*e*((1+t)*e-t)*.5:.5*((e-=2)*e*((1+t)*e+t)+2)}},Bounce:{In:function(e){return 1-a.Easing.Bounce.Out(1-e)},Out:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return e<.5?.5*a.Easing.Bounce.In(2*e):.5*a.Easing.Bounce.Out(2*e-1)+.5}}},a.Interpolation={Linear:function(e,t){var n=e.length-1,i=n*t,r=Math.floor(i),s=a.Interpolation.Utils.Linear;return t<0?s(e[0],e[1],i):1<t?s(e[n],e[n-1],n-i):s(e[r],e[n<r+1?n:r+1],i-r)},Bezier:function(e,t){for(var n=0,i=e.length-1,r=Math.pow,s=a.Interpolation.Utils.Bernstein,o=0;o<=i;o++)n+=r(1-t,i-o)*r(t,o)*e[o]*s(i,o);return n},CatmullRom:function(e,t){var n=e.length-1,i=n*t,r=Math.floor(i),s=a.Interpolation.Utils.CatmullRom;return e[0]===e[n]?(t<0&&(r=Math.floor(i=n*(1+t))),s(e[(r-1+n)%n],e[r],e[(r+1)%n],e[(r+2)%n],i-r)):t<0?e[0]-(s(e[0],e[0],e[1],e[1],-i)-e[0]):1<t?e[n]-(s(e[n],e[n],e[n-1],e[n-1],i-n)-e[n]):s(e[r?r-1:0],e[r],e[n<r+1?n:r+1],e[n<r+2?n:r+2],i-r)},Utils:{Linear:function(e,t,n){return(t-e)*n+e},Bernstein:function(e,t){var n=a.Interpolation.Utils.Factorial;return n(e)/n(t)/n(e-t)},Factorial:function(){var e=[1];return function(t){var n=1;if(e[t])return e[t];for(var i=t;1<i;i--)n*=i;return e[t]=n}}(),CatmullRom:function(e,t,n,i,r){var a=.5*(n-e),s=.5*(i-t),o=r*r;return(2*t-2*n+a+s)*(r*o)+(-3*t+3*n-2*a-s)*o+a*r+t}}},r=void 0,"function"==typeof define&&define.amd?define([],(function(){return a})):"undefined"!=typeof module&&"object"==typeof exports?module.exports=a:void 0!==r&&(r.TWEEN=a)},4849:function(e,t,n){n.d(t,{_:function(){return u}});var i=n(5671),r=n(3144),a=n(136),s=n(9388),o=n(3562),c=new WeakMap,u=function(e){(0,a.Z)(n,e);var t=(0,s.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e)).decoderPath="",r.decoderConfig={},r.decoderBinary=null,r.decoderPending=null,r.workerLimit=4,r.workerPool=[],r.workerNextTaskID=1,r.workerSourceURL="",r.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},r.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"},r}return(0,r.Z)(n,[{key:"setDecoderPath",value:function(e){return this.decoderPath=e,this}},{key:"setDecoderConfig",value:function(e){return this.decoderConfig=e,this}},{key:"setWorkerLimit",value:function(e){return this.workerLimit=e,this}},{key:"load",value:function(e,t,n,i){var r=this,a=new o.hH6(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,(function(e){var n={attributeIDs:r.defaultAttributeIDs,attributeTypes:r.defaultAttributeTypes,useUniqueIDs:!1};r.decodeGeometry(e,n).then(t).catch(i)}),n,i)}},{key:"decodeDracoFile",value:function(e,t,n,i){var r={attributeIDs:n||this.defaultAttributeIDs,attributeTypes:i||this.defaultAttributeTypes,useUniqueIDs:!!n};this.decodeGeometry(e,r).then(t)}},{key:"decodeGeometry",value:function(e,t){var n=this;for(var i in t.attributeTypes){var r=t.attributeTypes[i];void 0!==r.BYTES_PER_ELEMENT&&(t.attributeTypes[i]=r.name)}var a,s=JSON.stringify(t);if(c.has(e)){var o=c.get(e);if(o.key===s)return o.promise;if(0===e.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}var u=this.workerNextTaskID++,d=e.byteLength,l=this._getWorker(u,d).then((function(n){return a=n,new Promise((function(n,i){a._callbacks[u]={resolve:n,reject:i},a.postMessage({type:"decode",id:u,taskConfig:t,buffer:e},[e])}))})).then((function(e){return n._createGeometry(e.geometry)}));return l.catch((function(){return!0})).then((function(){a&&u&&n._releaseTask(a,u)})),c.set(e,{key:s,promise:l}),l}},{key:"_createGeometry",value:function(e){var t=new o.u9r;e.index&&t.setIndex(new o.TlE(e.index.array,1));for(var n=0;n<e.attributes.length;n++){var i=e.attributes[n],r=i.name,a=i.array,s=i.itemSize;t.setAttribute(r,new o.TlE(a,s))}return t}},{key:"_loadLibrary",value:function(e,t){var n=new o.hH6(this.manager);return n.setPath(this.decoderPath),n.setResponseType(t),n.setWithCredentials(this.withCredentials),new Promise((function(t,i){n.load(e,t,void 0,i)}))}},{key:"preload",value:function(){return this._initDecoder(),this}},{key:"_initDecoder",value:function(){var e=this;if(this.decoderPending)return this.decoderPending;var t="object"!==typeof WebAssembly||"js"===this.decoderConfig.type,n=[];return t?n.push(this._loadLibrary("draco_decoder.js","text")):(n.push(this._loadLibrary("draco_wasm_wrapper.js","text")),n.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(n).then((function(n){var i=n[0];t||(e.decoderConfig.wasmBinary=n[1]);var r=d.toString(),a=["/* draco decoder */",i,"","/* worker */",r.substring(r.indexOf("{")+1,r.lastIndexOf("}"))].join("\n");e.workerSourceURL=URL.createObjectURL(new Blob([a]))})),this.decoderPending}},{key:"_getWorker",value:function(e,t){var n=this;return this._initDecoder().then((function(){if(n.workerPool.length<n.workerLimit){var i=new Worker(n.workerSourceURL);i._callbacks={},i._taskCosts={},i._taskLoad=0,i.postMessage({type:"init",decoderConfig:n.decoderConfig}),i.onmessage=function(e){var t=e.data;switch(t.type){case"decode":i._callbacks[t.id].resolve(t);break;case"error":i._callbacks[t.id].reject(t);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+t.type+'"')}},n.workerPool.push(i)}else n.workerPool.sort((function(e,t){return e._taskLoad>t._taskLoad?-1:1}));var r=n.workerPool[n.workerPool.length-1];return r._taskCosts[e]=t,r._taskLoad+=t,r}))}},{key:"_releaseTask",value:function(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}},{key:"debug",value:function(){console.log("Task load: ",this.workerPool.map((function(e){return e._taskLoad})))}},{key:"dispose",value:function(){for(var e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}]),n}(o.aNw);function d(){var e,t;function n(e,t,n,i,r,a){var s=a.num_components(),o=n.num_points()*s,c=o*r.BYTES_PER_ELEMENT,u=function(e,t){switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32}}(e,r),d=e._malloc(c);t.GetAttributeDataArrayForAllPoints(n,a,u,c,d);var l=new r(e.HEAPF32.buffer,d,o).slice();return e._free(d),{name:i,array:l,itemSize:s}}onmessage=function(i){var r=i.data;switch(r.type){case"init":e=r.decoderConfig,t=new Promise((function(t){e.onModuleLoaded=function(e){t({draco:e})},DracoDecoderModule(e)}));break;case"decode":var a=r.buffer,s=r.taskConfig;t.then((function(e){var t=e.draco,i=new t.Decoder,o=new t.DecoderBuffer;o.Init(new Int8Array(a),a.byteLength);try{var c=function(e,t,i,r){var a,s,o=r.attributeIDs,c=r.attributeTypes,u=t.GetEncodedGeometryType(i);if(u===e.TRIANGULAR_MESH)a=new e.Mesh,s=t.DecodeBufferToMesh(i,a);else{if(u!==e.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");a=new e.PointCloud,s=t.DecodeBufferToPointCloud(i,a)}if(!s.ok()||0===a.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+s.error_msg());var d={index:null,attributes:[]};for(var l in o){var h=self[c[l]],f=void 0,v=void 0;if(r.useUniqueIDs)v=o[l],f=t.GetAttributeByUniqueId(a,v);else{if(-1===(v=t.GetAttributeId(a,e[o[l]])))continue;f=t.GetAttribute(a,v)}d.attributes.push(n(e,t,a,l,h,f))}u===e.TRIANGULAR_MESH&&(d.index=function(e,t,n){var i=3*n.num_faces(),r=4*i,a=e._malloc(r);t.GetTrianglesUInt32Array(n,r,a);var s=new Uint32Array(e.HEAPF32.buffer,a,i).slice();return e._free(a),{array:s,itemSize:1}}(e,t,a));return e.destroy(a),d}(t,i,o,s),u=c.attributes.map((function(e){return e.array.buffer}));c.index&&u.push(c.index.array.buffer),self.postMessage({type:"decode",id:r.id,geometry:c},u)}catch(d){console.error(d),self.postMessage({type:"error",id:r.id,error:d.message})}finally{t.destroy(o),t.destroy(i)}}))}}}}}]);